<!doctype html>
<html lang="kk">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bio360 ‚Ä¢ BioPassport</title>
<link rel="stylesheet" href="assets/style.css"/>
</head>
<body>

<header class="topbar">
<div class="wrap bar">
<div class="brand">
<div class="logo">B360</div>
<div>
<h1>BioPassport</h1>
<p class="sub">–û“õ—É—à—ã –ø—Ä–æ–≥—Ä–µ—Å—ñ ‚Ä¢ –¥–∞“ì–¥—ã –ø—Ä–æ—Ñ–∏–ª—ñ ‚Ä¢ –±–µ–π–¥–∂–¥–µ—Ä</p>
</div>
</div>
<nav class="nav">
<a class="pill" href="index.html">–ë–∞—Å—Ç—ã –±–µ—Ç</a>
<a class="pill" href="topics.html">–¢–∞“õ—ã—Ä—ã–ø—Ç–∞—Ä</a>
<a class="pill" href="teacher.html">–ú“±“ì–∞–ª—ñ–º</a>
</nav>
</div>
</header>

<main class="wrap">
<section class="panel">

<div class="panel-head">
<div>
<h2 id="pName">‚Äî</h2>
<p class="muted" id="pMeta">‚Äî</p>
</div>
<div class="badge" id="pLevel">‚Äî</div>
</div>

<div class="grid2" style="margin-top:15px">

<div class="card">
<h3>–î–∞“ì–¥—ã –ø—Ä–æ—Ñ–∏–ª—ñ</h3>

<div class="mrow">
<span>–¢“Ø—Å—ñ–Ω—É</span>
<div class="bar"><div id="mUnderstand" class="fill"></div></div>
<b id="tUnderstand">0</b>
</div>

<div class="mrow">
<span>“ö–æ–ª–¥–∞–Ω—É</span>
<div class="bar"><div id="mApply" class="fill"></div></div>
<b id="tApply">0</b>
</div>

<div class="mrow">
<span>–¢–∞–ª–¥–∞—É</span>
<div class="bar"><div id="mAnalyze" class="fill"></div></div>
<b id="tAnalyze">0</b>
</div>

<div class="mrow">
<span>Data</span>
<div class="bar"><div id="mData" class="fill"></div></div>
<b id="tData">0</b>
</div>

<div class="mrow">
<span>–î”ô–ª–µ–ª</span>
<div class="bar"><div id="mEvidence" class="fill"></div></div>
<b id="tEvidence">0</b>
</div>

<p class="muted small" id="nextStep" style="margin-top:10px"></p>
</div>

<div class="card">
<h3>–ë–µ–π–¥–∂–¥–µ—Ä</h3>
<div id="badges" class="badges"></div>
</div>

</div>

<hr class="hr"/>

<div class="card">
<h3>–°–æ“£“ì—ã –Ω”ô—Ç–∏–∂–µ</h3>
<div id="lastSummary" class="muted"></div>
</div>

</section>
</main>

<script src="assets/app.js"></script>

<script>
(function(){

const sess = Bio360.getSession();
const results = Bio360.getResults();

if(!sess){
document.getElementById("pName").innerText = "–û“õ—É—à—ã –∞–Ω—ã“õ—Ç–∞–ª–º–∞“ì–∞–Ω";
return;
}

const myResults = results.filter(r=>r.name===sess.name);

document.getElementById("pName").innerText = sess.name;
document.getElementById("pMeta").innerText = sess.cls + "-—Å—ã–Ω—ã–ø ‚Ä¢ –ù”ô—Ç–∏–∂–µ–ª–µ—Ä —Å–∞–Ω—ã: " + myResults.length;

if(myResults.length===0){
document.getElementById("lastSummary").innerText = "”ò–∑—ñ—Ä–≥–µ –Ω”ô—Ç–∏–∂–µ –∂–æ“õ.";
return;
}

let totalScore = 0;
let totalMax = 0;
let L1=0, L2=0, L3=0;

myResults.forEach(r=>{
totalScore += Number(r.score||0);
totalMax += Number(r.max||0);
if(r.level==="L1") L1++;
if(r.level==="L2") L2++;
if(r.level==="L3") L3++;
});

const percent = Math.round((totalScore/totalMax)*100);

let globalLevel = percent<50 ? "L1" :
percent<80 ? "L2" : "L3";

document.getElementById("pLevel").innerText = globalLevel + " ‚Ä¢ " + percent + "%";

function setMeter(id,val){
document.getElementById(id).style.width = val + "%";
}

setMeter("mUnderstand", percent);
setMeter("mApply", Math.min(percent+5,100));
setMeter("mAnalyze", Math.min(percent-5,100));
setMeter("mData", Math.min(percent+10,100));
setMeter("mEvidence", Math.min(percent,100));

document.getElementById("tUnderstand").innerText = percent;
document.getElementById("tApply").innerText = percent+5;
document.getElementById("tAnalyze").innerText = percent-5;
document.getElementById("tData").innerText = percent+10;
document.getElementById("tEvidence").innerText = percent;

document.getElementById("nextStep").innerText =
percent<60 ? "–ö–µ–ª–µ—Å—ñ “õ–∞–¥–∞–º: —Ç–µ–æ—Ä–∏—è–Ω—ã “õ–∞–π—Ç–∞–ª–∞—É." :
percent<85 ? "–ö–µ–ª–µ—Å—ñ “õ–∞–¥–∞–º: –∫“Ø—Ä–¥–µ–ª—ñ scenario –æ—Ä—ã–Ω–¥–∞—É." :
"–°–µ–Ω —Ç–µ—Ä–µ“£ –¥–µ“£–≥–µ–π–¥–µ—Å—ñ“£. Data-“ì–∞ –Ω–µ–≥—ñ–∑–¥–µ–ª–≥–µ–Ω –∂–æ–±–∞ –∂–∞—Å–∞.";

// –±–µ–π–¥–∂–¥–µ—Ä
let badgesHTML = "";
if(L3>=3) badgesHTML += `<div class="badge">üèÜ –¢–µ—Ä–µ“£ —Ç–∞–ª–¥–∞—É—à—ã</div>`;
if(percent>=80) badgesHTML += `<div class="badge">üî• –ñ–æ“ì–∞—Ä—ã –Ω”ô—Ç–∏–∂–µ</div>`;
if(myResults.length>=5) badgesHTML += `<div class="badge">üìö –ë–µ–ª—Å–µ–Ω–¥—ñ –æ“õ—É—à—ã</div>`;

if(!badgesHTML) badgesHTML = `<div class="muted">–ë–µ–π–¥–∂ –∂–æ“õ</div>`;

document.getElementById("badges").innerHTML = badgesHTML;

// —Å–æ“£“ì—ã –Ω”ô—Ç–∏–∂–µ
const last = myResults[0];
document.getElementById("lastSummary").innerHTML =
`–¢–∞“õ—ã—Ä—ã–ø: ${last.topicTitle||last.topic}<br>
–ë–∞–ª–ª: ${last.score}/${last.max}<br>
–î–µ“£–≥–µ–π: ${last.level}<br>
–ö“Ø–Ω—ñ: ${new Date(last.at).toLocaleString()}`;

})();
</script>

</body>
</html>
